# MacBrightFace

## 项目概述
MacBrightFace是一款macOS工具，在屏幕周围提供可调节的亮度，特别适合视频会议和直播场景。该工具针对不同类型显示器进行了优化，确保在各种显示器上都有优秀的亮度体验，尤其是Studio Display等HDR系数较低的显示器。

## 核心功能
- **精确亮度控制**：采用平滑亮度曲线计算算法，确保在整个0-100%范围内都有明显的亮度变化
- **HDR支持**：充分利用HDR显示器的能力，自动检测并适应不同HDR能力的显示器
- **显示器自适应**：自动检测显示器HDR系数（如2.0、3.0等），并据此优化亮度曲线
- **低资源占用**：优化渲染性能，确保在各种Mac设备上流畅运行
- **Studio Display优化**：专门针对HDR系数为2.0的显示器进行了优化，确保即使在HDR模式下也有明显的亮度变化
- **自动开启补光**：应用启动时自动开启补光灯
- **菜单栏状态同步**：菜单栏图标会正确反映补光灯的当前状态
- **补光灯尺寸调整**：提供小(80像素)和大(200像素)两种尺寸选择，方便快速切换补光灯大小
- **无缝贴合菜单栏**：顶部补光灯边缘直接贴合菜单栏底部，无多余间隙

## 项目结构

### 主要文件
- **LightApp.swift**：应用入口点和菜单管理、状态栏控制
- **LightController.swift**：补光灯核心控制器，负责窗口管理和亮度控制
- **LightView.swift**：实际的渲染视图，包含亮度计算和视觉效果逻辑
- **BrightnessSliderView.swift**：亮度滑动控制视图组件

### 关键类和模块
- **AppDelegate**：管理状态栏菜单、处理通知和亮度选项，负责菜单栏图标状态同步
- **LightController**：管理窗口创建、更新和亮度控制逻辑，通过通知与AppDelegate通信
- **LightView**：使用 SwiftUI 实现的亮度渲染组件
- **BrightnessSliderView**：自定义NSView，实现亮度滑动调节功能

## 亮度计算设计

应用采用了优化的亮度计算算法：

1. **HDR模式亮度计算**：
   - 使用显示器的真实HDR系数（通过`getMaxHDRBrightness()`获取）
   - 混合线性和二次曲线实现平滑的亮度变化
   - 确保在整个亮度范围内都有明显的视觉效果

2. **标准模式亮度计算**：
   - 使用与HDR模式类似的平滑曲线策略，但最大值更保守（1.5）
   - 确保即使在标准模式下也能有良好的亮度变化体验

## 用户界面

### 菜单选项
- **开/关补光灯**：一键切换补光灯状态，菜单栏图标会相应更新
- **滑动调节亮度**：提供连续滑动控制，可实时预览亮度变化
- **HDR 模式切换**：在支持 HDR 的设备上提供 HDR 模式开关
- **补光灯尺寸调整**：提供小(80像素)和大(200像素)两种尺寸选择

## 使用技术
- SwiftUI（用户界面）
- AppKit（系统集成）
- Metal（通过 drawingGroup() 进行高效渲染）
- NotificationCenter（组件间通信）